(function(){var e=0;var t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(t,n){var r=(new Date).getTime();var i=Math.max(0,16-(r-e));var s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}})();var RivalTracker=function(){RivalTracker=function(e,t,n,r){function k(){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("id","RivalTrackerLogo");e.setAttribute("transform",RivalTracker.paths[t].transform);e.addEventListener("mousedown",function(){window.open("http://racingrivals.samiad.co.uk/","_blank")},false);var n;for(var i in RivalTracker.paths["logo"].rival){n=document.createElementNS("http://www.w3.org/2000/svg","path");if(i==0){n.setAttribute("id","dot");h["dot"]=n}n.setAttribute("d",RivalTracker.paths["logo"].rival[i]);n.setAttribute("fill",r.pathColor);e.appendChild(n)}for(var i in RivalTracker.paths["logo"].tracker){n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",RivalTracker.paths["logo"].tracker[i]);n.setAttribute("fill",r.pathColor);e.appendChild(n)}var s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",322);s.setAttribute("y",230);s.setAttribute("text-anchor","middle");s.setAttribute("font-family",'Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif');s.setAttribute("fill",r.pathColor);s.setAttribute("font-weight","normal");s.setAttribute("font-size","18");s.textContent=RivalTracker.paths[t].name;e.appendChild(s);C.svg.appendChild(e)}function L(e){s[e]=i[e];var t=O(s[e]);circle=h[e];if(circle===undefined){var n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("id",e+"Node");n.setAttribute("cx",t.x);n.setAttribute("cy",t.y);n.setAttribute("r",r.nodeSize);n.setAttribute("fill",D());n.setAttribute("stroke",r.nodeStrokeColor);n.setAttribute("stroke-width",r.nodeStrokeWidth);if(typeof r.callback==="function"){n.addEventListener("mousedown",r.callback,false)}C.svg.appendChild(n);h[e]=n;var o=document.createElementNS("http://www.w3.org/2000/svg","text");if(typeof r.callback==="function"){o.addEventListener("mousedown",r.callback,false)}o.setAttribute("id",e+"Label");o.setAttribute("x",t.x);o.setAttribute("y",t.y+r.nodeSize/4-r.labelVertOffset);o.setAttribute("fill",r.labelColor);o.setAttribute("font-family",r.labelFont);o.setAttribute("font-size",r.labelFontSize);o.setAttribute("font-weight","bolder");o.setAttribute("stroke-width",r.labelStrokeWidth);o.setAttribute("stroke",r.labelStrokeColor);o.setAttribute("text-anchor","middle");o.textContent=e;C.svg.appendChild(o);p[e]=o}else{circle.setAttribute("display","inline");circle.setAttribute("cx",t.x);circle.setAttribute("cy",t.y);o=p[e];o.setAttribute("display","inline");o.setAttribute("x",t.x);o.setAttribute("y",t.y+r.nodeSize/4-r.labelVertOffset)}}function A(e){circle=h[e];driverLabel=p[e];circle.setAttribute("display","none");driverLabel.setAttribute("display","none")}function O(e){if(e===0){e+=1e-4}return d.getPointAtLength(v/100*e)}function M(){var e={};for(var t in n){e[t]=n[t]}return e}function _(){var e="0123456789ABCDEF".split("");var t="#";for(var n=0;n<6;n++){t+=e[Math.round(Math.random()*15)]}return t}function D(){if(N.length<1){return _()}else{return N.shift()}}function B(){if(l<-50){u=f}else{u=a}F=false;if(H){return}P=m.shift();if(P==undefined){return}H=true;P.expires=Date.now()+P.duration;if(r.maxPrediction>0)P.expires-=17;i=P.data;for(var e in i){if(s[e]>i[e]){if(!i[e]>10){}}}for(var e in s){if(i[e]===undefined){A(e);delete s[e]}}var t;for(var e in i){if(s[e]===undefined){L(e)}t=i[e]-s[e];if(t<-20)t+=100;if(t>90)t-=100;o[e]=t/P.duration}}function I(e){if(!r.reportBufferStatus)return;if(e===S)return;h["dot"].setAttribute("fill",e);S=e}var i=M();var s=M();var o={};var u=1;var a=1;var f=.8;var l=0;var c=0;var h={};var p={};var d;var v;var m=new Array;var g=500;var y=true;var b=300;var w=Date.now();var E=document.getElementById(e);var S="#000000";var x=false;var T=0;var N=["#000066","#00FFFF","#0000FF","#80FF00","#808080","#00FF00","#A02820","#FF00FF","#008000","#800000","#000080","#808000","#FFA000","#800080","#FF0000","#C0C0C0","#008080","#F080F0","#FF0066","#CC3366","#996666","#669966","#33CC66","#00FF66","#FFCCCC","#CCCCCC","#99CCCC","#66CCCC","#33CCCC","#00FFCC","#330066","#9900FF","#6699FF","#6666CC","#996633","#330000","#330033","#990066"];if(RivalTracker.paths[t]==undefined)t="defaultMap";if(typeof r==="undefined"){var r={scaling:100,maxPrediction:8e3,pathColor:"#000000",pathStrokeWidth:6,nodeSize:15,nodeStrokeWidth:2,nodeStrokeColor:"#000000",labelFont:"Arial",labelFontSize:"11px",labelStrokeWidth:2,labelStrokeColor:"#000000",labelColor:"#FFFFFF",labelVertOffset:0,reportBufferStatus:true}}else{r.scaling=typeof r.scaling==="undefined"?"100":r.scaling;r.maxPrediction=typeof r.maxPrediction==="undefined"?8e3:r.maxPrediction;r.pathColor=typeof r.pathColor==="undefined"?"#000000":r.pathColor;r.pathStrokeWidth=typeof r.pathStrokeWidth==="undefined"?6:r.pathStrokeWidth;r.nodeSize=typeof r.nodeSize==="undefined"?15:r.nodeSize;r.nodeStrokeWidth=typeof r.nodeStrokeWidth==="undefined"?2:r.nodeStrokeWidth;r.nodeStrokeColor=typeof r.nodeStrokeColor==="undefined"?"#000000":r.nodeStrokeColor;r.labelFont=typeof r.labelFont==="undefined"?"Arial":r.labelFont;r.labelFontSize=typeof r.labelFontSize==="undefined"?"11px":r.labelFontSize;r.labelStrokeWidth=typeof r.labelStrokeWidth==="undefined"?0:r.labelStrokeWidth;r.labelStrokeColor=typeof r.labelStrokeColor==="undefined"?"#ffffff":r.labelStrokeColor;r.labelColor=typeof r.labelColor==="undefined"?"#ffffff":r.labelColor;r.labelVertOffset=typeof r.labelVertOffset==="undefined"?0:r.labelVertOffset;r.reportBufferStatus=typeof r.reportBufferStatus==="undefined"?true:r.reportBufferStatus}var C=this;this.svg=function(){var e="http://www.w3.org/2000/svg";var n=document.createElementNS(e,"svg");n.setAttribute("width","100%");var i=E.clientWidth===0?document.documentElement.clientWidth:E.clientWidth;n.setAttribute("width",i*r.scaling/100);var s=i*(RivalTracker.paths[t].height/100);s=s*r.scaling/100;n.setAttribute("height",s);n.setAttribute("preserveAspectRatio","xMinYMin slice");n.setAttribute("viewBox",RivalTracker.paths[t].viewBox);n.setAttribute("wmode","transparent");return n}();(function(){var n;for(var i in RivalTracker.paths[t].paths){n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",RivalTracker.paths[t].paths[i]);n.setAttribute("stroke-miterlimit","4");n.setAttribute("stroke-width",r.pathStrokeWidth);n.setAttribute("stroke-dasharray","none");n.setAttribute("stroke",r.pathColor);n.setAttribute("fill","none");if(i==0){n.setAttribute("id","trackPath");n.setAttribute("stroke-opacity","1");d=n}else{n.setAttribute("stroke-opacity","0.2")}C.svg.appendChild(n);v=d.getTotalLength()}var s=O(0);var o=O(.1);var u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",s.x);u.setAttribute("y1",s.y-15);u.setAttribute("x2",s.x);u.setAttribute("y2",s.y+15);var a=s.x-o.x;var f=s.y-o.y;var l=Math.atan(f/a)*(180/Math.PI);var c="rotate("+l+" "+s.x+" "+s.y+")";u.setAttribute("transform",c);u.setAttribute("stroke-width",r.pathStrokeWidth);u.setAttribute("stroke",r.pathColor);C.svg.appendChild(u);k()})();(function(){document.getElementById(e).appendChild(C.svg)})();(function(){for(var t in i){if(i.hasOwnProperty(t)){L(t)}}})();this.updatePositions=function(){var e=Date.now();var t;if(x){i=M();w=e;x=false;y=true;T=0;return}var n=e-w;if(n<b)n=b;if(y){n+=g;y=false}if(c>0){var r=e-c;t=n-r+17;c=0}else{t=n}l=T;if(T<0){t+=T;T=0}if(t<=0)t=1;m.push({data:M(),duration:t});T+=t;w=e;B()};var P;var H=false;var j;var F=false;(function q(){requestAnimationFrame(q);var e=Date.now();var t=e-(j||e);j=e;if(P==undefined){return}T-=t;if(e>=P.expires){H=false;if(m.length>0){B()}else{F=true;I("#FFCC00");if(e>=P.expires+r.maxPrediction){F=false;P=undefined;c=e;I("#FF0000");return}}}if(!F)I("#00FF00");for(var n in i){circle=h[n];driverLabel=p[n];if(typeof o[n]=="undefined")continue;var a=o[n]*t;if(F){if(a<0){a=0}else{a*=u}}if(f===0)continue;var f=s[n]+a;if(f>100)f-=100;if(f<0)f+=100;var l=O(f);circle.setAttribute("cx",l.x);circle.setAttribute("cy",l.y);driverLabel.setAttribute("x",l.x);driverLabel.setAttribute("y",l.y+r.nodeSize/4-r.labelVertOffset);s[n]=f}})();this.setNodeColor=function(e,t){h[e].setAttribute("fill",t)};this.setNodeStrokeColor=function(e,t){h[e].setAttribute("stroke",t)};this.setNodeStrokeWidth=function(e,t){h[e].setAttribute("stroke-width",t)};this.setNodeStrokeDash=function(e){h[e].setAttribute("stroke-dasharray","3,4")};this.setLabelColor=function(e,t){p[e].setAttribute("fill",t)};this.resetBuffer=function(){x=true;I("#FF0000")}};return RivalTracker}()