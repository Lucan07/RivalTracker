(function(){var e=0;var t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(t,n){var r=(new Date).getTime();var i=Math.max(0,16-(r-e));var s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}})();var RivalTracker=function(){RivalTracker=function(e,t,n,r){function S(){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("id","RivalTrackerLogo");e.setAttribute("transform",RivalTracker.paths[t].transform);e.addEventListener("mousedown",function(){window.open("http://racingrivals.samiad.co.uk/","_blank")},false);var n;for(var i in RivalTracker.paths["logo"].rival){n=document.createElementNS("http://www.w3.org/2000/svg","path");if(i==0){n.setAttribute("id","dot");l["dot"]=n}n.setAttribute("d",RivalTracker.paths["logo"].rival[i]);n.setAttribute("fill",r.pathColor);e.appendChild(n)}for(var i in RivalTracker.paths["logo"].tracker){n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",RivalTracker.paths["logo"].tracker[i]);n.setAttribute("fill",r.pathColor);e.appendChild(n)}var s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",322);s.setAttribute("y",230);s.setAttribute("text-anchor","middle");s.setAttribute("font-family",'Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif');s.setAttribute("fill",r.pathColor);s.setAttribute("font-weight","normal");s.setAttribute("font-size","18");s.textContent=RivalTracker.paths[t].name;e.appendChild(s);E.svg.appendChild(e)}function x(e){s[e]=i[e];var t=N(s[e]);circle=l[e];if(circle===undefined){var n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("id",e+"Node");n.setAttribute("cx",t.x);n.setAttribute("cy",t.y);n.setAttribute("r",r.nodeSize);n.setAttribute("fill",L());n.setAttribute("stroke",r.nodeStrokeColor);n.setAttribute("stroke-width",r.nodeStrokeWidth);if(typeof r.callback==="function"){n.addEventListener("mousedown",r.callback,false)}E.svg.appendChild(n);l[e]=n;var o=document.createElementNS("http://www.w3.org/2000/svg","text");if(typeof r.callback==="function"){o.addEventListener("mousedown",r.callback,false)}o.setAttribute("id",e+"Label");o.setAttribute("x",t.x);o.setAttribute("y",t.y+r.nodeSize/4-r.labelVertOffset);o.setAttribute("fill",r.labelColor);o.setAttribute("font-family",r.labelFont);o.setAttribute("font-size",r.labelFontSize);o.setAttribute("font-weight","bolder");o.setAttribute("stroke-width",r.labelStrokeWidth);o.setAttribute("stroke",r.labelStrokeColor);o.setAttribute("text-anchor","middle");o.textContent=e;E.svg.appendChild(o);c[e]=o}else{circle.setAttribute("display","inline");circle.setAttribute("cx",t.x);circle.setAttribute("cy",t.y);o=c[e];o.setAttribute("display","inline");o.setAttribute("x",t.x);o.setAttribute("y",t.y+r.nodeSize/4-r.labelVertOffset)}}function T(e){circle=l[e];driverLabel=c[e];circle.setAttribute("display","none");driverLabel.setAttribute("display","none")}function N(e){if(e===0){e+=1e-4}return h.getPointAtLength(p/100*e)}function C(){var e={};for(var t in n){e[t]=n[t]}return e}function k(){var e="0123456789ABCDEF".split("");var t="#";for(var n=0;n<6;n++){t+=e[Math.round(Math.random()*15)]}return t}function L(){if(w.length<1){return k()}else{return w.shift()}}function M(){if(a<-50){u=.1}else{u=.8}D=false;if(O){return}A=d.shift();if(A==undefined){return}O=true;A.expires=Date.now()+A.duration;if(r.maxPrediction>0)A.expires-=17;i=A.data;for(var e in i){if(s[e]>i[e]){if(!i[e]>10){console.log("COLLISION! - driver already at "+s[e]+" and should only be at "+i[e]+" at the end of "+A.duration+" seconds!!")}}}for(var e in s){if(i[e]===undefined){T(e);delete s[e]}}var t;for(var e in i){if(s[e]===undefined){x(e)}t=i[e]-s[e];if(t<-20)t+=100;if(t>90)t-=100;o[e]=t/A.duration}}function P(e){if(!r.reportBufferStatus)return;if(e===g)return;l["dot"].setAttribute("fill",e);g=e}var i=C();var s=C();var o={};var u=.8;var a=0;var f=0;var l={};var c={};var h;var p;var d=new Array;var v=Date.now();var m=document.getElementById(e);var g="#000000";var y=false;var b=0;var w=["#000066","#00FFFF","#0000FF","#80FF00","#808080","#00FF00","#A02820","#FF00FF","#008000","#800000","#000080","#808000","#FFA000","#800080","#FF0000","#C0C0C0","#008080","#F080F0","#FF0066","#CC3366","#996666","#669966","#33CC66","#00FF66","#FFCCCC","#CCCCCC","#99CCCC","#66CCCC","#33CCCC","#00FFCC","#330066","#9900FF","#6699FF","#6666CC","#996633","#330000","#330033","#990066"];if(RivalTracker.paths[t]==undefined)t="default";if(typeof r==="undefined"){var r={scaling:100,maxPrediction:8e3,pathColor:"#000000",pathStrokeWidth:6,nodeSize:15,nodeStrokeWidth:2,nodeStrokeColor:"#000000",labelFont:"Arial",labelFontSize:"11px",labelStrokeWidth:2,labelStrokeColor:"#000000",labelColor:"#FFFFFF",labelVertOffset:0,reportBufferStatus:true}}else{r.scaling=typeof r.scaling==="undefined"?"100":r.scaling;r.maxPrediction=typeof r.maxPrediction==="undefined"?8e3:r.maxPrediction;r.pathColor=typeof r.pathColor==="undefined"?"#000000":r.pathColor;r.pathStrokeWidth=typeof r.pathStrokeWidth==="undefined"?6:r.pathStrokeWidth;r.nodeSize=typeof r.nodeSize==="undefined"?15:r.nodeSize;r.nodeStrokeWidth=typeof r.nodeStrokeWidth==="undefined"?2:r.nodeStrokeWidth;r.nodeStrokeColor=typeof r.nodeStrokeColor==="undefined"?"#000000":r.nodeStrokeColor;r.labelFont=typeof r.labelFont==="undefined"?"Arial":r.labelFont;r.labelFontSize=typeof r.labelFontSize==="undefined"?"11px":r.labelFontSize;r.labelStrokeWidth=typeof r.labelStrokeWidth==="undefined"?0:r.labelStrokeWidth;r.labelStrokeColor=typeof r.labelStrokeColor==="undefined"?"#ffffff":r.labelStrokeColor;r.labelColor=typeof r.labelColor==="undefined"?"#ffffff":r.labelColor;r.labelVertOffset=typeof r.labelVertOffset==="undefined"?0:r.labelVertOffset;r.reportBufferStatus=typeof r.reportBufferStatus==="undefined"?true:r.reportBufferStatus}var E=this;this.svg=function(){var e="http://www.w3.org/2000/svg";var n=document.createElementNS(e,"svg");n.setAttribute("width","100%");var i=m.clientWidth===0?document.documentElement.clientWidth:m.clientWidth;n.setAttribute("width",i*r.scaling/100);var s=i*(RivalTracker.paths[t].height/100);s=s*r.scaling/100;n.setAttribute("height",s);n.setAttribute("preserveAspectRatio","xMinYMin slice");n.setAttribute("viewBox",RivalTracker.paths[t].viewBox);n.setAttribute("wmode","transparent");return n}();(function(){var n;for(var i in RivalTracker.paths[t].paths){n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",RivalTracker.paths[t].paths[i]);n.setAttribute("stroke-miterlimit","4");n.setAttribute("stroke-width",r.pathStrokeWidth);n.setAttribute("stroke-dasharray","none");n.setAttribute("stroke",r.pathColor);n.setAttribute("fill","none");if(i==0){n.setAttribute("id","trackPath");n.setAttribute("stroke-opacity","1");h=n}else{n.setAttribute("stroke-opacity","0.2")}E.svg.appendChild(n);p=h.getTotalLength()}var s=N(0);var o=N(.1);var u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",s.x);u.setAttribute("y1",s.y-15);u.setAttribute("x2",s.x);u.setAttribute("y2",s.y+15);var a=s.x-o.x;var f=s.y-o.y;var l=Math.atan(f/a)*(180/Math.PI);var c="rotate("+l+" "+s.x+" "+s.y+")";u.setAttribute("transform",c);u.setAttribute("stroke-width",r.pathStrokeWidth);u.setAttribute("stroke",r.pathColor);E.svg.appendChild(u);S()})();(function(){document.getElementById(e).appendChild(E.svg)})();(function(){for(var t in i){if(i.hasOwnProperty(t)){x(t)}}})();this.updatePositions=function(){var e=Date.now();var t;if(y){i=C();v=e;y=false;b=0;return}var n=e-v;if(f>0){var r=e-f;t=n-r+17;f=0}else{t=n}a=b;if(b<0){t+=b;b=0}d.push({data:C(),duration:t});b+=t;console.log("New update added to queue, duration of "+t+", "+d.length+" updates queued, mB : "+b);v=e;M()};var A;var O=false;var _;var D=false;(function H(){requestAnimationFrame(H);var e=Date.now();var t=e-(_||e);_=e;if(A==undefined){return}b-=t;if(e>=A.expires){O=false;if(d.length>0){M()}else{D=true;P("#FFCC00");if(e>=A.expires+r.maxPrediction){D=false;A=undefined;f=e;P("#FF0000");return}}}if(!D)P("#00FF00");for(var n in i){circle=l[n];driverLabel=c[n];var a=o[n]*t;if(D){if(a<0){a=0}else{a*=u}}if(h===0)continue;var h=s[n]+a;if(h>100)h-=100;if(h<0)h+=100;var p=N(h);circle.setAttribute("cx",p.x);circle.setAttribute("cy",p.y);driverLabel.setAttribute("x",p.x);driverLabel.setAttribute("y",p.y+r.nodeSize/4-r.labelVertOffset);s[n]=h}})();this.setNodeColor=function(e,t){l[e].setAttribute("fill",t)};this.setNodeStrokeColor=function(e,t){l[e].setAttribute("stroke",t)};this.setNodeStrokeWidth=function(e,t){l[e].setAttribute("stroke-width",t)};this.setNodeStrokeDash=function(e){l[e].setAttribute("stroke-dasharray","3,4")};this.setLabelColor=function(e,t){c[e].setAttribute("fill",t)};this.resetBuffer=function(){y=true;P("#FF0000")}};return RivalTracker}()